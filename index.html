<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rajdhani ‚Äì Jodi Panel Pattern AI</title>
<style>
body{font-family:Arial}
table{border-collapse:collapse;font-size:13px}
td,th{border:1px solid #999;padding:5px;text-align:center;font-weight:600}
td[contenteditable]{background:#fffbe6}
.blank{background:#eee;cursor:pointer}
.circle{border:3px solid red;border-radius:50%}
.base{background:#ffeb3b}
#lineCanvas{position:absolute;left:0;top:0;pointer-events:none}
#checks div{background:#e8ffe8;margin:4px;padding:6px;cursor:pointer}
#ai,#future{background:#eef;padding:8px;margin-top:6px;font-weight:600}
#popup{position:fixed;left:0;right:0;bottom:0;background:#fff;
border-top:3px solid #000;display:none;max-height:55%;overflow:auto}
button{margin:4px}
</style>
</head>
<body>

<h2>Rajdhani ‚Äì Jodi Panel Pattern AI</h2>

<input type="file" id="csv">
<button onclick="addRow()">Add Row</button>
<button onclick="saveData()">Save</button>

<hr>
<b>üîç Jodi Panel Search</b><br>
Day:
<select id="daySel">
<option value="0">Mon</option>
<option value="1">Tue</option>
<option value="2">Wed</option>
<option value="3">Thu</option>
<option value="4">Fri</option>
</select>

Jodi:
<input id="jodiInput" placeholder="00‚Äì99" size="4">
<button onclick="panelSearch()">Panel Mode Search</button>

<table id="tbl"></table>

<h3>‚úî Check Lines</h3>
<div id="checks"></div>

<h3>ü§ñ AI Result</h3>
<div id="ai"></div>

<h3>üîÆ Future (Strong Prediction)</h3>
<div id="future"></div>

<div id="popup">
<button onclick="popup.style.display='none'">Close</button>
<div id="popData"></div>
</div>

<script>
/* ================= CONFIG ================= */
const STORAGE_KEY="pdata_Rajdhani";
const COLS=5;

/* ================= FAMILY ================= */
const families={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"HR":["05","16","27","38","49","50","61","72","83","94"],
"FR":["00","11","22","33","44","55","66","77","88","99"]
};
const fam=v=>{for(let k in families) if(families[k].includes(v)) return k; return "NA";}
const palti=v=>v[1]+v[0];
const norm=v=>(!v||v=="**")?"**":(v.length==1?"0"+v:v);
const match=(a,b)=>a!="**"&&(a===b||palti(a)===b||fam(a)===fam(b));

/* ================= DATA ================= */
let data=JSON.parse(localStorage.getItem(STORAGE_KEY)||"null");
if(!data){
data=[
["51","91","41","57","19"],
["05","90","74","06","19"],
["90","34","82","09","28"],
["**","**","**","**","**"]
];
}
data=data.map(r=>r.map(norm));

/* ================= DRAW ================= */
const tbl=document.getElementById("tbl");
function draw(){
let h="<tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th></tr>";
data.forEach(r=>{
h+="<tr>";
r.forEach(v=>h+=`<td>${v}</td>`);
h+="</tr>";
});
tbl.innerHTML=h;
}
draw();

function addRow(){
data.push(Array(COLS).fill("**"));
draw();
}
function saveData(){
localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
alert("Saved");
}

/* ================= PANEL SEARCH ENGINE ================= */
function panelSearch(){
const baseJodi=norm(document.getElementById("jodiInput").value);
const col=parseInt(document.getElementById("daySel").value);
if(baseJodi=="**") return alert("Enter Jodi");

let ref=[];
let start=Math.max(0,data.length-10);
for(let i=start;i<data.length;i++){
for(let c=0;c<COLS;c++){
if(match(data[i][c],baseJodi)){
ref.push({r:i,c,v:data[i][c]});
}
}
}

if(!ref.length){alert("No reference pattern");return;}

let matches=[];
for(let i=0;i<data.length-3;i++){
let ok=true;
ref.forEach(p=>{
if(!match(data[i+(p.r-start)][p.c],baseJodi)) ok=false;
});
if(ok) matches.push(i);
}

showPanelResult(baseJodi,col,ref,matches);
}

/* ================= POPUP ================= */
function showPanelResult(base,col,ref,matches){
let html="<h4>Reference Pattern (Bottom)</h4><table>";
ref.forEach(p=>{
html+=`<tr><td>${p.r}</td><td>${p.c}</td><td class="circle">${p.v}</td></tr>`;
});
html+="</table><hr>";

let jc={};
matches.forEach(i=>{
let r=i+ref.length;
if(r<data.length){
let v=data[r][col];
if(v!="**"){
jc[v]=(jc[v]||0)+1;
jc[palti(v)]=(jc[palti(v)]||0)+0.5;
families[fam(v)]?.forEach(x=>jc[x]=(jc[x]||0)+0.2);
}
}
});

let top=Object.entries(jc).sort((a,b)=>b[1]-a[1]).slice(0,4).map(x=>x[0]);
html+="<h4>Strong Jodi</h4>"+top.join(", ");

popData.innerHTML=html;
popup.style.display="block";
}
</script>
</body>
</html>
