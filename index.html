<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pattern System</title>
<style>
table{border-collapse:collapse;font-size:12px}
td,th{border:1px solid #999;padding:4px;text-align:center}
.blank{background:#eee;cursor:pointer}
.circle{border:3px solid red;border-radius:50%}
#checks{margin-top:10px;padding:8px;background:#eaffea}
</style>
</head>
<body>

<h3>Pattern System</h3>
<table id="tbl"></table>

<h4>âœ” Check Lines</h4>
 <div id="popup" style="display:none;
 position:fixed;left:0;top:0;right:0;bottom:0;
 background:rgba(0,0,0,.5);">
  <div style="background:#fff;margin:40px;padding:10px;max-height:80%;overflow:auto">
    <button onclick="closePop()">Close</button>
    <div id="popData"></div>
  </div>
 </div>
<div id="checks">No pattern yet</div>

<script>
// ===== FAMILY DATA =====
const families={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"HR":["05","16","27","38","49","50","61","72","83","94"],
"FR":["00","11","22","33","44","55","66","77","88","99"]
};

function palti(v){return v[1]+v[0];}
function getFamily(v){
 for(let k in families) if(families[k].includes(v)) return k;
 return "NA";
}

// ===== SAMPLE DATA =====
let data=[
["51","91","41","57","19","95"],
["05","90","74","06","19","63"],
["90","34","82","09","28","19"],
["72","34","21","32","21","42"],
["58","84","00","67","06","98"],
["03","82","29","90","14","66"],
["02","40","92","85","00","88"],
["39","94","33","58","11","63"],
["91","69","60","71","85","20"],
["95","28","11","29","28","18"],
["47","83","45","80","33","18"],
["96","25","78","59","30","94"],
["","","","","",""] // blank row
];

function draw(){
 let t="<tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>";
 data.forEach((r,ri)=>{
  t+="<tr>";
  r.forEach((c,ci)=>{
    if(c==="") t+=`<td class="blank" onclick="makePattern(${ri},${ci})">**</td>`;
    else t+=`<td id="c-${ri}-${ci}">${c}</td>`;
  });
  t+="</tr>";
 });
 document.getElementById("tbl").innerHTML=t;
}
draw();

// ===== MAIN LOGIC =====
function makePattern(r,c){
 clearCircles();
 let seq=[];
 for(let i=r-1;i>=0 && seq.length<4;i--){
   if(data[i][c]!="") seq.unshift(data[i][c]);
 }
 if(seq.length<4){
   alert("Upar 4 valid row nahi mile");
   return;
 }
 // convert to rule objects
 let rule=seq.map(v=>({
   jodi:v,
   palti:palti(v),
   fam:getFamily(v)
 }));
 searchPattern(rule);
}

function matchCell(val,rule){
 if(val===rule.jodi) return true;
 if(val===rule.palti) return true;
 if(getFamily(val)===rule.fam) return true;
 return false;
}

function searchPattern(rule){
 let found=0;
 lastMatches=[];
 for(let c=0;c<6;c++){
  for(let r=0;r<=data.length-4;r++){
    let ok=true;
    for(let k=0;k<4;k++){
      let v=data[r+k][c];
      if(v==="" || !matchCell(v,rule[k])){ok=false;break;}
    }
    if(ok){
      found++;
      let block=[];
      for(let k=0;k<5;k++){ // 4 + extra row
        if(data[r+k]) block.push([...data[r+k]]);
      }
      lastMatches.push(block);

      for(let k=0;k<4;k++){
        let id="c-"+(r+k)+"-"+c;
        let el=document.getElementById(id);
        if(el) el.classList.add("circle");
      }
    }
  }
 }
 let chk=document.getElementById("checks");
 chk.innerHTML = found>0 ? "Pattern found at "+found+" places (click to view)" : "No match found";
 chk.onclick = found>0 ? showPopup : null;
   }

 function showPopup(){
 let h="";
 lastMatches.forEach((blk,i)=>{
   h+="<h4>Match "+(i+1)+"</h4><table border='1'>";
   blk.forEach(r=>{
     h+="<tr>"+r.map(c=>"<td>"+(c||"**")+"</td>").join("")+"</tr>";
   });
   h+="</table><br>";
 });
 document.getElementById("popData").innerHTML=h;
 document.getElementById("popup").style.display="block";
}

function closePop(){
 document.getElementById("popup").style.display="none";
}
function clearCircles(){
 document.querySelectorAll(".circle").forEach(x=>x.classList.remove("circle"));
}
</script>
</body>
</html>
