<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rajdhani ‚Äì Ai Strong Trick</title>
<style>
body{font-family:Arial}
table{border-collapse:collapse;font-size:13px}
td,th{border:1px solid #999;padding:5px;text-align:center;font-weight:600}
td[contenteditable]{background:#fffbe6}
.blank{background:#eee;cursor:pointer}
.circle{border:3px solid red;border-radius:50%}
.baseSquare{outline:4px solid blue;border-radius:4px}
#checks div{background:#e8ffe8;margin:4px;padding:6px;cursor:pointer}
#ai,#future{background:#eef;padding:8px;margin-top:6px;font-weight:600}
#popup{position:fixed;left:0;right:0;bottom:0;background:#fff;
border-top:3px solid #000;display:none;max-height:50%;overflow:auto}
button{margin:4px}
</style>
</head>

<body>
<h2>Rajdhani ‚Äì Ai Strong Trick</h2>

<input type="file" id="csv">
<button onclick="addRow()">Add Row</button>
<button onclick="saveData()">Save</button>

<hr>
<h3>üîç Base Jodi Pattern Mode</h3>
Base Jodi:
<input id="baseJodiInput" placeholder="29" maxlength="2">
Rows:
<select id="rowCount">
<option value="7">7</option>
<option value="8">8</option>
<option value="10" selected>10</option>
</select>
<button onclick="runBaseJodiPattern()">Run Pattern</button>
<hr>

<table id="tbl"></table>

<h3>‚úî Check Lines</h3>
<div id="checks"></div>

<h3>ü§ñ AI Suggestions</h3>
<div id="ai"></div>

<h3>üîÆ Future AI</h3>
<div id="future"></div>

<div id="popup">
<button onclick="popup.style.display='none'">Close</button>
<div id="popData"></div>
</div>

<script>
/* ================= BASIC ================= */
const STORAGE_KEY="pdata_Rajdhani";
const COLS=5;
let targetCol=null;

/* ================= FAMILY ================= */
const families={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"HR":["05","16","27","38","49","50","61","72","83","94"],
"FR":["00","11","22","33","44","55","66","77","88","99"]
};
const fam=v=>{for(let k in families) if(families[k].includes(v)) return k; return "NA";}
const palti=v=>v[1]+v[0];
const norm=v=>(!v||v=="**")?"**":(v.length==1?"0"+v:v);
const smartMatch=(a,b)=>a!="**"&&b!="**"&&(a===b||palti(a)===b||fam(a)===fam(b));

/* ================= DATA ================= */
let data=JSON.parse(localStorage.getItem(STORAGE_KEY)||"null");
if(!data){
data=[
["51","91","41","57","19"],
["05","90","74","06","19"],
["90","34","82","09","28"],
["**","**","**","**","**"]
];
}
data=data.map(r=>r.map(norm));

/* ================= BASE JODI STATE ================= */
let BJ_ACTIVE=false;
let BJ_BASE="";
let BJ_ROWS=10;
let BJ_PATTERN=null;

/* ================= DRAW ================= */
let activeMark=null;
const tbl=document.getElementById("tbl");

function draw(){
let h="<tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th></tr>";
data.forEach((r,ri)=>{
h+="<tr>";
r.forEach((c,ci)=>{
let cls="";
if(activeMark){
let i=ri-activeMark.start;
if(i>=0&&i<activeMark.shape.length&&activeMark.shape[i][ci]) cls="circle";
}
if(BJ_ACTIVE&&BJ_PATTERN){
let key=ri+"-"+ci;
if(BJ_PATTERN.baseCell===key) cls+=" baseSquare";
if(BJ_PATTERN.circles[key]) cls+=" circle";
}
h+=`<td class="${c=="**"?"blank":cls}" contenteditable
oninput="edit(${ri},${ci},this)">${c}</td>`;
});
h+="</tr>";
});
tbl.innerHTML=h;
}
draw();

/* ================= BASIC OPS ================= */
function edit(r,c,e){data[r][c]=norm(e.innerText.trim());}
function addRow(){data.push(Array(COLS).fill("**"));draw();}
function saveData(){localStorage.setItem(STORAGE_KEY,JSON.stringify(data));alert("Saved");}

/* ================= CSV ================= */
csv.onchange=e=>{
let fr=new FileReader();
fr.onload=()=>{
let rows=fr.result.replace(/\r/g,"").trim().split("\n");
if(rows[0].toLowerCase().includes("mon")) rows.shift();
data=rows.map(r=>{
let a=r.split(",").map(v=>norm(v.trim()));
while(a.length<COLS) a.push("**");
return a.slice(0,COLS);
});
saveData(); draw();
};
fr.readAsText(e.target.files[0]);
};

/* ================= BASE JODI LOGIC ================= */
function findBaseRow(jodi){
for(let r=data.length-1;r>=0;r--){
for(let c=0;c<COLS;c++){
if(data[r][c]===jodi) return r;
}
}
return -1;
}

function buildBottomPattern(baseRow,rows){
let circles={},baseCell=null;
for(let i=0;i<=rows;i++){
let r=baseRow+i;
if(!data[r]) continue;
for(let c=0;c<COLS;c++){
let v=data[r][c];
if(v=="**") continue;
let key=r+"-"+c;
if(r===baseRow&&v===BJ_BASE){baseCell=key;continue;}
if(v===BJ_BASE||palti(v)===BJ_BASE||fam(v)===fam(BJ_BASE)){
circles[key]=true;
}
}
}
return {baseCell,circles};
}

function runBaseJodiPattern(){
BJ_BASE=norm(document.getElementById("baseJodiInput").value);
BJ_ROWS=parseInt(document.getElementById("rowCount").value);
if(!BJ_BASE||BJ_BASE=="**"){alert("Base jodi likho");return;}
let br=findBaseRow(BJ_BASE);
if(br==-1){alert("Base jodi record me nahi");return;}
BJ_PATTERN=buildBottomPattern(br,BJ_ROWS);
BJ_ACTIVE=true;
draw();
}
</script>
</body>
</html>
