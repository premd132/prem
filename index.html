<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Auto Pattern System</title>
<style>
body{font-family:Arial}
table{border-collapse:collapse;font-size:13px}
td,th{border:1px solid #999;padding:5px;text-align:center;font-weight:600}
.blank{background:#eee;cursor:pointer}
.circle{border:3px solid red;border-radius:50%}
.mark{background:yellow}
#checks div{background:#e8ffe8;margin:4px;padding:6px;cursor:pointer}
#popup{position:fixed;left:0;right:0;bottom:0;background:#fff;
border-top:3px solid #000;display:none;max-height:50%;overflow:auto}
</style>
</head>
<body>

<h2>Auto Pattern System</h2>
<table id="tbl"></table>

<h3>âœ” Check Lines (Top 3)</h3>
<div id="checks"></div>

<div id="popup">
<button onclick="popup.style.display='none'">Close</button>
<div id="popData"></div>
</div>

<script>
/* ===== FAMILY ===== */
const families={
"12":["12","17","21","26","62","67","71","76"],
"13":["13","18","31","36","63","68","81","86"],
"14":["14","19","41","46","64","69","91","96"],
"15":["01","06","10","15","51","56","60","65"],
"23":["23","28","32","37","73","78","82","87"],
"24":["24","29","42","47","74","79","92","97"],
"25":["02","07","20","25","52","57","70","75"],
"34":["34","39","43","48","84","89","93","98"],
"35":["03","08","30","35","53","58","80","85"],
"45":["04","09","40","45","54","59","90","95"],
"HR":["05","16","27","38","49","50","61","72","83","94"],
"FR":["00","11","22","33","44","55","66","77","88","99"]
};

function fam(v){
 for(let k in families) if(families[k].includes(v)) return k;
 return "NA";
}
function palti(v){return v[1]+v[0];}

/* ===== SAMPLE DATA ===== */
let data=[
["91","69","60","71","85","20"],
["95","28","11","29","28","18"],
["47","83","45","80","33","18"],
["96","25","78","59","30","94"],
["**","**","**","**","**","**"]
];

/* ===== DRAW ===== */
function draw(){
 let h="<tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th></tr>";
 data.forEach((r,ri)=>{
  h+="<tr>";
  r.forEach((c,ci)=>{
   if(c=="**") h+=`<td class="blank" onclick="startPattern(${ri},${ci})">**</td>`;
   else h+=`<td onclick="pickBase(${ri},${ci})">${c}</td>`;
  });
  h+="</tr>";
 });
 tbl.innerHTML=h;
}
draw();

/* ===== GLOBAL ===== */
let baseCell=null;
let liveShape=null;

/* ===== STEP 1: BLANK CLICK ===== */
function startPattern(r,c){
 let shape=[];
 for(let i=r-4;i<=r;i++){
  if(i<0) continue;
  let row=[];
  for(let j=0;j<6;j++){
   row.push(data[i][j]!="**"?1:0);
  }
  shape.push(row);
 }
 liveShape=shape;
 alert("Ab base jodi par click karo");
}

/* ===== STEP 2: BASE JODI ===== */
function pickBase(r,c){
 if(!liveShape) return;
 baseCell={r,c,val:data[r][c]};
 runAutoSearch();
}

/* ===== AUTO SEARCH ===== */
function runAutoSearch(){
 let results=[];
 for(let i=0;i<data.length-4;i++){
  for(let j=0;j<6;j++){
   let score=0;
   for(let k=0;k<5;k++){
    let v=data[i+k][j];
    if(v=="**") continue;
    if(v==baseCell.val) score+=3;
    if(palti(v)==baseCell.val) score+=2;
    if(fam(v)==fam(baseCell.val)) score+=1;
   }
   if(score>0) results.push({i,j,score});
  }
 }
 results.sort((a,b)=>b.score-a.score);
 results=results.slice(0,3);
 showChecks(results);
}

/* ===== CHECK LINES ===== */
function showChecks(arr){
 checks.innerHTML="";
 arr.forEach((m,idx)=>{
  let d=document.createElement("div");
  d.innerText=(idx+1)+". Auto match (score "+m.score+")";
  d.onclick=()=>showMatch(m);
  checks.appendChild(d);
 });
}

/* ===== SHOW MATCH ===== */
function showMatch(m){
 let html="<table>";
 for(let i=m.i;i<m.i+5;i++){
  html+="<tr>";
  for(let j=0;j<6;j++){
   let cls="";
   if(j==m.j) cls="class='circle'";
   html+=`<td ${cls}>${data[i][j]}</td>`;
  }
  html+="</tr>";
 }
 html+="</table>";
 popData.innerHTML=html;
 popup.style.display="block";
}
</script>
</body>
</html>
